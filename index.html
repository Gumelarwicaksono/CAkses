<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Camera Pro Akses</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .filter-studio { filter: brightness(1.1) contrast(1.05) saturate(1.1); }
        .filter-smooth { filter: contrast(0.95) brightness(1.05) blur(0.4px); }
        .bokeh-active { 
            backdrop-filter: blur(8px); 
            mask-image: radial-gradient(circle, black 30%, transparent 70%);
            -webkit-mask-image: radial-gradient(circle, black 30%, transparent 70%);
        }
        video { object-fit: cover; background: #000; }
    </style>
</head>
<body class="bg-black h-screen w-screen flex items-center justify-center overflow-hidden m-0">

<div class="camera-container relative w-full max-w-md h-[85vh] bg-gray-900 rounded-3xl overflow-hidden shadow-2xl border-4 border-gray-800">
    <video id="video" autoplay playsinline muted class="w-full h-full transition-all duration-500"></video>

    <div id="bokeh-layer" class="absolute inset-0 pointer-events-none opacity-0 transition-opacity duration-500 bokeh-active"></div>
    <div id="studio-overlay" class="absolute inset-0 pointer-events-none opacity-0 transition-opacity duration-500 bg-gradient-to-b from-white/10 via-transparent to-black/20"></div>

    <button id="switch-btn" class="absolute top-5 right-5 z-50 bg-white/20 backdrop-blur-md p-3 rounded-full text-white active:scale-90 transition">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 7v6h-6"/><path d="M3 17V11h6"/><path d="M3 13a9 9 0 0 1 15-6.7L21 7"/><path d="M21 11a9 9 0 0 1-15 6.7L3 17"/></svg>
    </button>

    <div class="absolute bottom-24 left-0 right-0 flex justify-center gap-2 z-40">
        <div id="filter-menu" class="hidden flex bg-black/60 backdrop-blur-xl p-2 rounded-2xl border border-white/20 overflow-x-auto mx-4">
            <button onclick="applyFilter('original')" class="px-4 py-2 text-white text-xs font-bold hover:bg-white/20 rounded-xl">ORIGINAL</button>
            <button onclick="applyFilter('smooth')" class="px-4 py-2 text-white text-xs font-bold hover:bg-white/20 rounded-xl">MULUS</button>
            <button onclick="applyFilter('studio')" class="px-4 py-2 text-white text-xs font-bold hover:bg-white/20 rounded-xl">STUDIO</button>
            <button onclick="applyFilter('bokeh')" class="px-4 py-2 text-yellow-400 text-xs font-bold hover:bg-white/20 rounded-xl">BOKEH</button>
        </div>
    </div>

    <div class="absolute bottom-6 left-0 right-0 flex justify-center items-center z-40">
        <button id="toggle-filter" class="text-white flex flex-col items-center gap-1 active:scale-90 transition">
            <div class="p-4 bg-white/10 rounded-full backdrop-blur-md border border-white/20">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"/><path d="M17.64 15 22 10.64"/><path d="m15 19 3.5-3.5"/><path d="M13.5 13 17 9.5"/><path d="M17.2 5.8a2.12 2.12 0 1 0-3-3l-3.8 3.76"/><path d="m21.8 10.4-3.76-3.8c-.82-.82-2.13-.85-3-.03l-.07.07"/></svg>
            </div>
            <span class="text-[10px] font-black uppercase tracking-widest mt-1">Pilih Efek</span>
        </button>
    </div>
</div>

<script>
    const video = document.getElementById('video');
    const switchBtn = document.getElementById('switch-btn');
    const filterMenu = document.getElementById('filter-menu');
    const toggleFilterBtn = document.getElementById('toggle-filter');
    const studioOverlay = document.getElementById('studio-overlay');
    const bokehLayer = document.getElementById('bokeh-layer');

    let currentFacingMode = "user";
    let currentStream = null;

    async function startCamera(facingMode) {
        // 1. Matikan stream sebelumnya agar tidak bentrok
        if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
        }

        const constraints = {
            video: { 
                facingMode: facingMode,
                width: { ideal: 1280 },
                height: { ideal: 720 }
            },
            audio: false
        };

        try {
            const stream = await navigator.mediaDevices.getUserMedia(constraints);
            currentStream = stream;
            video.srcObject = stream;
            
            // Mirroring hanya jika kamera depan
            video.style.transform = (facingMode === "user") ? "scaleX(-1)" : "scaleX(1)";
            
            // Pastikan video diputar
            video.onloadedmetadata = () => {
                video.play().catch(e => console.error("Auto-play blocked:", e));
            };

        } catch (err) {
            console.error("Error Akses Kamera:", err);
            if (err.name === "NotAllowedError") {
                alert("Izin kamera ditolak. Silakan izinkan di pengaturan browser.");
            } else {
                alert("Kamera tidak ditemukan atau sedang digunakan aplikasi lain.");
            }
        }
    }

    // Event Listeners
    switchBtn.onclick = () => {
        currentFacingMode = (currentFacingMode === "user") ? "environment" : "user";
        startCamera(currentFacingMode);
    };

    toggleFilterBtn.onclick = () => filterMenu.classList.toggle('hidden');

    window.applyFilter = function(type) {
        // Reset
        video.className = "w-full h-full transition-all duration-500";
        studioOverlay.style.opacity = "0";
        bokehLayer.style.opacity = "0";

        if (type === 'smooth') video.classList.add('filter-smooth');
        if (type === 'studio') {
            video.classList.add('filter-studio');
            studioOverlay.style.opacity = "1";
        }
        if (type === 'bokeh') bokehLayer.style.opacity = "1";
    };

    // Jalankan kamera saat halaman dimuat
    window.addEventListener('load', () => startCamera(currentFacingMode));
</script>
</body>
</html>
